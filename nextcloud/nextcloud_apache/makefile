BASE_VOLUME=
NC_DB_VOLUME=${BASE_VOLUME}/db
NC_DATA_VOLUME=${BASE_VOLUME}/nextcloud

NC_DB_HOST=host.docker.internal
NC_DB_PORT=5432
NC_DB_NAME=nextcloud
NC_DB_USER=nextcloud
NC_DB_PWD=
NC_ADMIN_USER=admin
NC_ADMIN_PASSWORD=
NC_PORT=


build:
	DB_VOLUME=${NC_DB_VOLUME} \
	DATA_VOLUME=${NC_DATA_VOLUME} \
	POSTGRES_DB=${NC_DB_NAME} \
	POSTGRES_USER=${NC_DB_USER} \
	POSTGRES_PASSWORD=${NC_DB_PWD} \
	NEXTCLOUD_ADMIN_USER=${NC_ADMIN_USER} \
	NEXTCLOUD_ADMIN_PASSWORD=${NC_ADMIN_PASSWORD} \
	NEXTCLOUD_PORT=${NC_PORT} \
	docker-compose build

up:
	DB_VOLUME=${NC_DB_VOLUME} \
	DATA_VOLUME=${NC_DATA_VOLUME} \
	POSTGRES_DB=${NC_DB_NAME} \
	POSTGRES_USER=${NC_DB_USER} \
	POSTGRES_PASSWORD=${NC_DB_PWD} \
	NEXTCLOUD_ADMIN_USER=${NC_ADMIN_USER} \
	NEXTCLOUD_ADMIN_PASSWORD=${NC_ADMIN_PASSWORD} \
	NEXTCLOUD_PORT=${NC_PORT} \
	docker-compose up -d

down:
	DB_VOLUME=${NC_DB_VOLUME} \
	DATA_VOLUME=${NC_DATA_VOLUME} \
	POSTGRES_DB=${NC_DB_NAME} \
	POSTGRES_USER=${NC_DB_USER} \
	POSTGRES_PASSWORD=${NC_DB_PWD} \
	NEXTCLOUD_ADMIN_USER=${NC_ADMIN_USER} \
	NEXTCLOUD_ADMIN_PASSWORD=${NC_ADMIN_PASSWORD} \
	NEXTCLOUD_PORT=${NC_PORT} \
	docker-compose down

docker_db:
	docker run \
		--name postgres12 \
		-it \
		-v ${NC_DB_VOLUME}:/var/lib/postgresql/data \
		-p ${NC_DB_PORT}:5432 \
		-e POSTGRES_DB=${NC_DB_NAME} \
		-e POSTGRES_USER=${NC_DB_USER} \
		-e POSTGRES_PASSWORD=${NC_DB_PWD} \
		postgres:12.2-alpine

docker_nc:
	docker run \
		--name nextcloud18 \
		-it \
		-v ${NC_DATA_VOLUME}:/var/www/html \
		-p ${NC_PORT}:80 \
		-e NEXTCLOUD_ADMIN_USER=${NC_ADMIN_USER} \
		-e NEXTCLOUD_ADMIN_PASSWORD=${NC_ADMIN_PASSWORD} \
		-e POSTGRES_HOST=${NC_DB_HOST}:${NC_DB_PORT} \
		-e POSTGRES_DB=${NC_DB_NAME} \
		-e POSTGRES_USER=${NC_DB_USER} \
		-e POSTGRES_PASSWORD=${NC_DB_PWD} \
		-e NEXTCLOUD_TABLE_PREFIX=nc_ \
		nextcloud:18.0.2-apache

